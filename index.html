<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔥 Internet Time Capsule - Last Messages Before The End</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'VT323', monospace;
            background: linear-gradient(45deg, #000000, #1a0000, #330000);
            background-size: 400% 400%;
            animation: apocalypseGradient 15s ease infinite;
            color: #00ff00;
            min-height: 100vh;
            overflow-x: hidden;
        }

        @keyframes apocalypseGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .glitch {
            animation: glitch 2s infinite;
        }

        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            border: 3px solid #ff0000;
            margin-bottom: 30px;
            background: rgba(255, 0, 0, 0.1);
            box-shadow: 0 0 20px #ff0000;
        }

        h1 {
            font-size: 3em;
            color: #ff0000;
            text-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000;
            margin-bottom: 10px;
        }

        .countdown {
            font-size: 2em;
            color: #ffff00;
            text-shadow: 0 0 10px #ffff00;
            margin: 20px 0;
        }

        .warning {
            color: #ff6600;
            font-size: 1.5em;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0.3; }
        }

        .input-section {
            background: rgba(0, 255, 0, 0.05);
            border: 2px solid #00ff00;
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 10px;
        }

        .input-section h2 {
            color: #00ff00;
            margin-bottom: 20px;
            font-size: 2em;
        }

        input, textarea, select {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: #000;
            border: 2px solid #00ff00;
            color: #00ff00;
            font-family: 'VT323', monospace;
            font-size: 1.2em;
        }

        textarea {
            min-height: 150px;
            resize: vertical;
        }

        button {
            background: #ff0000;
            color: #fff;
            border: none;
            padding: 15px 40px;
            font-size: 1.5em;
            font-family: 'VT323', monospace;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s;
            box-shadow: 0 0 10px #ff0000;
        }

        button:hover {
            background: #ff3300;
            box-shadow: 0 0 20px #ff0000;
            transform: scale(1.05);
        }

        .messages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .message-card {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid;
            padding: 20px;
            border-radius: 10px;
            position: relative;
            transition: all 0.3s;
        }

        .message-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px;
        }

        .message-card.confession { border-color: #ff0066; box-shadow: 0 0 10px #ff0066; }
        .message-card.regret { border-color: #6600ff; box-shadow: 0 0 10px #6600ff; }
        .message-card.wisdom { border-color: #00ffff; box-shadow: 0 0 10px #00ffff; }
        .message-card.meme { border-color: #ffff00; box-shadow: 0 0 10px #ffff00; }
        .message-card.code { border-color: #00ff00; box-shadow: 0 0 10px #00ff00; }

        .message-type {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 5px;
            font-size: 0.9em;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .message-content {
            color: #fff;
            font-size: 1.2em;
            line-height: 1.5;
            margin: 15px 0;
            word-wrap: break-word;
        }

        .message-author {
            color: #888;
            font-size: 1em;
            margin-top: 15px;
        }

        .message-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .message-actions button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            padding: 5px 10px;
            font-size: 0.9em;
            cursor: pointer;
        }

        .message-actions button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .reaction-count {
            display: inline-block;
            margin-left: 5px;
            color: #ffff00;
        }

        .search-box {
            width: 100%;
            padding: 15px;
            margin: 20px 0;
            background: #000;
            border: 2px solid #00ff00;
            color: #00ff00;
            font-family: 'VT323', monospace;
            font-size: 1.2em;
        }

        .sort-buttons {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            justify-content: center;
        }

        .sort-btn {
            background: rgba(255, 255, 0, 0.2);
            color: #ffff00;
            border: 2px solid #ffff00;
            padding: 8px 15px;
            font-size: 1em;
            cursor: pointer;
        }

        .sort-btn.active {
            background: #ffff00;
            color: #000;
        }

        .message-card .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff0000;
            border: none;
            color: #fff;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1em;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .message-card:hover .delete-btn {
            opacity: 1;
        }

        .apocalypse-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: pulse 1s infinite;
        }

        .apocalypse-mode.active {
            display: flex;
        }

        .apocalypse-content {
            text-align: center;
            color: #fff;
            font-size: 3em;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }



        .view-mode {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 10px 0;
        }

        .view-btn {
            background: rgba(0, 255, 255, 0.2);
            color: #00ffff;
            border: 2px solid #00ffff;
            padding: 8px 15px;
            font-size: 1em;
            cursor: pointer;
        }

        .view-btn.active {
            background: #00ffff;
            color: #000;
        }

        .messages-list {
            display: none;
        }

        .messages-list.active {
            display: block;
        }

        .message-item {
            background: rgba(0, 0, 0, 0.8);
            border-left: 4px solid #00ff00;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            padding: 20px;
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid #ff0000;
            border-radius: 10px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 3em;
            color: #ff0000;
            text-shadow: 0 0 10px #ff0000;
        }

        .stat-label {
            font-size: 1.2em;
            color: #00ff00;
        }

        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }

        .filter-btn {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
            border: 2px solid #00ff00;
            padding: 10px 20px;
            font-size: 1.2em;
        }

        .filter-btn.active {
            background: #00ff00;
            color: #000;
        }

        code {
            background: #1a1a1a;
            padding: 2px 6px;
            border-radius: 3px;
            color: #00ff00;
        }

        .error-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #ff0000;
            color: #fff;
            padding: 30px;
            border: 3px solid #fff;
            border-radius: 10px;
            display: none;
            z-index: 1000;
            font-size: 1.5em;
            box-shadow: 0 0 50px #ff0000;
            animation: popupPulse 0.5s ease;
        }

        @keyframes popupPulse {
            0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .sound-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 255, 0, 0.2);
            border: 2px solid #00ff00;
            color: #00ff00;
            padding: 10px 20px;
            cursor: pointer;
            font-family: 'VT323', monospace;
            font-size: 1.2em;
            z-index: 100;
            transition: all 0.3s;
        }

        .sound-toggle:hover {
            background: #00ff00;
            color: #000;
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: #ff0000;
            width: 2px;
            height: 2px;
            animation: fall linear infinite;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh);
                opacity: 0;
            }
        }

        .easter-egg {
            position: fixed;
            bottom: 10px;
            right: 10px;
            font-size: 0.8em;
            color: #333;
            cursor: pointer;
        }

        .easter-egg:hover {
            color: #ff0000;
        }

        @media (max-width: 768px) {
            h1 { font-size: 2em; }
            .countdown { font-size: 1.5em; }
            .messages-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <button class="sound-toggle" onclick="toggleSound()">🔊 SOUND: OFF</button>
    
    <div class="particles" id="particles"></div>
    
    <div class="apocalypse-mode" id="apocalypseMode">
        <div class="apocalypse-content">
            <h1>🔥 THE END IS HERE 🔥</h1>
            <p id="apocalypseMessage">INITIATING FINAL PROTOCOL...</p>
        </div>
    </div>
    
    <div class="container">
        <header class="glitch">
            <h1>🔥 INTERNET TIME CAPSULE 🔥</h1>
            <p class="warning">⚠️ APOCALYPSE PROTOCOL ACTIVATED ⚠️</p>
            <div class="countdown" id="countdown">TIME REMAINING: CALCULATING...</div>
            <p style="color: #fff; font-size: 1.3em;">What would you say if the internet was ending tomorrow?</p>
        </header>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-number" id="totalMessages">0</div>
                <div class="stat-label">MESSAGES SAVED</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="timeLeft">??:??:??</div>
                <div class="stat-label">TIME REMAINING</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="survivors">0</div>
                <div class="stat-label">SURVIVORS</div>
            </div>
        </div>

        <div class="input-section">
            <h2>📝 LEAVE YOUR MARK ON THE INTERNET</h2>
            <input type="text" id="authorName" placeholder="Your name (or Anonymous)">
            
            <select id="messageType">
                <option value="">-- Select Message Type --</option>
                <option value="confession">💔 Last Confession</option>
                <option value="regret">😭 Biggest Regret</option>
                <option value="wisdom">🧠 Final Wisdom</option>
                <option value="meme">😂 One Last Meme</option>
                <option value="code">💻 Final Code Snippet</option>
            </select>
            
            <textarea id="messageContent" placeholder="Your message to the internet... Make it count!"></textarea>
            
            <button onclick="saveMessage()">🚀 SEND TO TIME CAPSULE</button>
            <button onclick="randomApocalypseQuote()" style="background: #6600ff;">🎲 NEED INSPIRATION?</button>
            
            <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                <button onclick="exportMessages()" style="background: #00cc00; font-size: 1.2em; padding: 10px 20px;">💾 EXPORT MESSAGES</button>
                <button onclick="shareApp()" style="background: #0099ff; font-size: 1.2em; padding: 10px 20px;">📤 SHARE APP</button>
                <button onclick="burnEverything()" style="background: #990000; font-size: 1.2em; padding: 10px 20px;">🔥 BURN ALL</button>
            </div>
            
            <p style="color: #888; font-size: 1em; margin-top: 15px; text-align: center;">
                💡 Keyboard shortcuts: Ctrl/Cmd+Enter to submit, Ctrl/Cmd+E to export
            </p>
        </div>

        <input type="text" class="search-box" id="searchBox" placeholder="🔍 Search messages..." onkeyup="searchMessages()">

        <div class="sort-buttons">
            <button class="sort-btn active" onclick="sortMessages('newest')">⏰ NEWEST</button>
            <button class="sort-btn" onclick="sortMessages('oldest')">📅 OLDEST</button>
            <button class="sort-btn" onclick="sortMessages('author')">👤 BY AUTHOR</button>
            <button class="sort-btn" onclick="sortMessages('popular')">🔥 POPULAR</button>
        </div>

        <div class="filter-buttons">
            <button class="filter-btn active" onclick="filterMessages('all')">ALL</button>
            <button class="filter-btn" onclick="filterMessages('confession')">💔 CONFESSIONS</button>
            <button class="filter-btn" onclick="filterMessages('regret')">😭 REGRETS</button>
            <button class="filter-btn" onclick="filterMessages('wisdom')">🧠 WISDOM</button>
            <button class="filter-btn" onclick="filterMessages('meme')">😂 MEMES</button>
            <button class="filter-btn" onclick="filterMessages('code')">💻 CODE</button>
        </div>

        <div class="view-mode">
            <button class="view-btn active" onclick="switchView('grid')">📱 GRID VIEW</button>
            <button class="view-btn" onclick="switchView('list')">📋 LIST VIEW</button>
        </div>

        <div class="messages-grid active" id="messagesGrid"></div>
        <div class="messages-list" id="messagesList"></div>
        
        <div class="easter-egg" onclick="konami()" title="Try the Konami Code: ↑↑↓↓←→←→BA">
            💀 ???
        </div>
    </div>

    <div class="error-popup" id="errorPopup">
        <p id="errorMessage"></p>
    </div>

    <script>
        // Initialize
        let messages = JSON.parse(localStorage.getItem('apocalypseMessages')) || [];
        let currentFilter = 'all';
        let soundEnabled = false;
        let konamiCode = [];
        let currentSort = 'newest';
        let currentView = 'grid';
        let searchQuery = '';
        let currentUser = localStorage.getItem('apocalypseUser') || null;
        const konamiSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
        
        // Initialize reactions in messages
        messages = messages.map(msg => ({
            ...msg,
            reactions: msg.reactions || { fire: 0, skull: 0, heart: 0 },
            id: msg.id || Date.now() + Math.random(),
            userId: msg.userId || 'demo_user_' + Math.random().toString(36).substr(2, 9)
        }));
        
        // Save updated messages back
        localStorage.setItem('apocalypseMessages', JSON.stringify(messages));
        
        // Initialize user session
        function initUser() {
            if (!currentUser) {
                currentUser = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('apocalypseUser', currentUser);
            }
        }
        initUser();
        
        // Sample starter messages
        const starterMessages = [
            {
                id: 'starter_1',
                author: "Anonymous Coder",
                type: "code",
                content: "function saveWorld() {\n  return hope * courage;\n}\n// Last commit before the end",
                timestamp: Date.now() - 3600000,
                reactions: { fire: 5, skull: 2, heart: 8 },
                userId: 'demo_user_1'
            },
            {
                id: 'starter_2',
                author: "Digital Philosopher",
                type: "wisdom",
                content: "The internet taught me that we're all connected, but also that we should've spent less time arguing in comment sections.",
                timestamp: Date.now() - 7200000,
                reactions: { fire: 12, skull: 1, heart: 15 },
                userId: 'demo_user_2'
            },
            {
                id: 'starter_3',
                author: "Meme Lord",
                type: "meme",
                content: "*This is fine dog meme* but the house is the entire internet",
                timestamp: Date.now() - 1800000,
                reactions: { fire: 20, skull: 5, heart: 3 },
                userId: 'demo_user_3'
            }
        ];

        // Add starter messages if empty
        if (messages.length === 0) {
            messages = starterMessages;
            localStorage.setItem('apocalypseMessages', JSON.stringify(messages));
        }

        // Countdown timer
        function updateCountdown() {
            const endDate = new Date();
            endDate.setHours(23, 59, 59, 999);
            const now = new Date();
            const diff = endDate - now;

            if (diff > 0) {
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                document.getElementById('timeLeft').textContent = 
                    `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                document.getElementById('countdown').textContent = 
                    `TIME REMAINING: ${hours}h ${minutes}m ${seconds}s`;
            } else {
                document.getElementById('countdown').textContent = 'THE END HAS ARRIVED';
                document.getElementById('timeLeft').textContent = '00:00:00';
            }
        }

        // Save message
        function saveMessage() {
            const author = document.getElementById('authorName').value.trim() || 'Anonymous';
            const type = document.getElementById('messageType').value;
            const content = document.getElementById('messageContent').value.trim();

            if (!type) {
                showError('⚠️ SELECT A MESSAGE TYPE!');
                return;
            }

            if (!content) {
                showError('⚠️ WRITE SOMETHING! THE INTERNET IS ENDING!');
                return;
            }

            const message = {
                id: Date.now() + Math.random(),
                author,
                type,
                content,
                timestamp: Date.now(),
                reactions: { fire: 0, skull: 0, heart: 0 },
                userId: currentUser
            };

            messages.unshift(message);
            localStorage.setItem('apocalypseMessages', JSON.stringify(messages));

            // Clear form
            document.getElementById('authorName').value = '';
            document.getElementById('messageType').value = '';
            document.getElementById('messageContent').value = '';

            // Refresh display
            displayMessages();
            updateStats();

            // Success feedback
            showError('✅ MESSAGE SAVED TO TIME CAPSULE!');
        }

        // Display messages
        function displayMessages() {
            const grid = document.getElementById('messagesGrid');
            const list = document.getElementById('messagesList');
            
            let filtered = currentFilter === 'all' 
                ? messages 
                : messages.filter(m => m.type === currentFilter);

            // Search filter
            if (searchQuery) {
                filtered = filtered.filter(m => 
                    m.content.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    m.author.toLowerCase().includes(searchQuery.toLowerCase())
                );
            }

            // Sort
            filtered = sortMessagesList(filtered);

            const typeLabels = {
                confession: '💔 CONFESSION',
                regret: '😭 REGRET',
                wisdom: '🧠 WISDOM',
                meme: '😂 MEME',
                code: '💻 CODE'
            };

            // Grid view
            grid.innerHTML = filtered.map(msg => {
                const timeAgo = getTimeAgo(msg.timestamp);
                const formattedContent = msg.type === 'code' 
                    ? `<code>${escapeHtml(msg.content)}</code>`
                    : escapeHtml(msg.content);
                
                const totalReactions = (msg.reactions?.fire || 0) + (msg.reactions?.skull || 0) + (msg.reactions?.heart || 0);
                const canDelete = msg.userId === currentUser;
                const deleteBtn = canDelete ? `<button class="delete-btn" onclick="deleteMessage('${msg.id}')">×</button>` : '';

                return `
                    <div class="message-card ${msg.type}">
                        ${deleteBtn}
                        <span class="message-type">${typeLabels[msg.type]}</span>
                        <div class="message-content">${formattedContent}</div>
                        <div class="message-author">— ${escapeHtml(msg.author)} | ${timeAgo}</div>
                        <div class="message-actions">
                            <button onclick="addReaction('${msg.id}', 'fire')">🔥 <span class="reaction-count">${msg.reactions?.fire || 0}</span></button>
                            <button onclick="addReaction('${msg.id}', 'skull')">💀 <span class="reaction-count">${msg.reactions?.skull || 0}</span></button>
                            <button onclick="addReaction('${msg.id}', 'heart')">❤️ <span class="reaction-count">${msg.reactions?.heart || 0}</span></button>
                            <button onclick="copyMessage('${msg.id}')">📋 Copy</button>
                        </div>
                    </div>
                `;
            }).join('');

            // List view
            list.innerHTML = filtered.map(msg => {
                const timeAgo = getTimeAgo(msg.timestamp);
                const preview = msg.content.substring(0, 100) + (msg.content.length > 100 ? '...' : '');
                
                return `
                    <div class="message-item ${msg.type}">
                        <strong>${typeLabels[msg.type]}</strong> by ${escapeHtml(msg.author)}
                        <p>${escapeHtml(preview)}</p>
                        <small>${timeAgo} | 🔥 ${msg.reactions?.fire || 0} 💀 ${msg.reactions?.skull || 0} ❤️ ${msg.reactions?.heart || 0}</small>
                    </div>
                `;
            }).join('');
        }

        // Filter messages
        function filterMessages(type) {
            currentFilter = type;
            
            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            displayMessages();
        }

        // Update stats
        function updateStats() {
            document.getElementById('totalMessages').textContent = messages.length;
            document.getElementById('survivors').textContent = 
                new Set(messages.map(m => m.author)).size;
        }

        // Random apocalypse quotes for inspiration
        function randomApocalypseQuote() {
            const quotes = [
                "If I had one more day online, I'd finally update my LinkedIn...",
                "I should've backed up my life. Literally.",
                "The cloud is falling. We should've seen it coming.",
                "My biggest regret? Not finishing that side project.",
                "console.log('Goodbye, World!');",
                "404: Future not found",
                "The server is down. Forever.",
                "I wish I'd spent less time debugging and more time living.",
                "My last commit message: 'It works on my machine... for now'",
                "Turns out 'move fast and break things' had consequences."
            ];
            
            const quote = quotes[Math.floor(Math.random() * quotes.length)];
            document.getElementById('messageContent').value = quote;
        }

        // Helper functions
        function getTimeAgo(timestamp) {
            const diff = Date.now() - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            
            if (hours > 0) return `${hours}h ago`;
            if (minutes > 0) return `${minutes}m ago`;
            return 'just now';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML.replace(/\n/g, '<br>');
        }

        function showError(message) {
            const popup = document.getElementById('errorPopup');
            const messageEl = document.getElementById('errorMessage');
            messageEl.textContent = message;
            popup.style.display = 'block';
            setTimeout(() => {
                popup.style.display = 'none';
            }, 2000);
        }

        // Initialize display
        displayMessages();
        updateStats();
        updateCountdown();
        setInterval(updateCountdown, 1000);

        // Random glitch effect
        setInterval(() => {
            if (Math.random() > 0.95) {
                document.body.style.filter = 'hue-rotate(180deg) invert(1)';
                setTimeout(() => {
                    document.body.style.filter = 'none';
                }, 100);
            }
        }, 3000);

        // Export messages feature
        function exportMessages() {
            const dataStr = JSON.stringify(messages, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `apocalypse-messages-${Date.now()}.json`;
            link.click();
            URL.revokeObjectURL(url);
            showError('📦 MESSAGES EXPORTED!');
        }

        // Clear all messages (apocalypse button!)
        function burnEverything() {
            if (confirm('🔥 BURN ALL MESSAGES? THIS CANNOT BE UNDONE! 🔥')) {
                if (confirm('ARE YOU ABSOLUTELY SURE? THE APOCALYPSE IS FINAL!')) {
                    messages = [];
                    localStorage.removeItem('apocalypseMessages');
                    displayMessages();
                    updateStats();
                    showError('🔥 EVERYTHING BURNED TO ASHES 🔥');
                }
            }
        }

        // Share message to clipboard
        function shareApp() {
            const text = `🔥 Internet Time Capsule - What would you say if the internet was ending tomorrow?\n\nLeave your final message: ${window.location.href}`;
            navigator.clipboard.writeText(text).then(() => {
                showError('📋 LINK COPIED! SPREAD THE WORD!');
            }).catch(() => {
                showError('❌ COPY FAILED - MANUAL SHARE REQUIRED');
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + Enter to submit
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                saveMessage();
            }
            // Ctrl/Cmd + E to export
            if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
                e.preventDefault();
                exportMessages();
            }
            
            // Konami code detector
            konamiCode.push(e.key);
            if (konamiCode.length > konamiSequence.length) {
                konamiCode.shift();
            }
            if (konamiCode.join(',') === konamiSequence.join(',')) {
                activateKonami();
                konamiCode = [];
            }
        });

        // Sound system
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const btn = document.querySelector('.sound-toggle');
            btn.textContent = soundEnabled ? '🔊 SOUND: ON' : '🔊 SOUND: OFF';
            if (soundEnabled) playSound('toggle');
        }

        function playSound(type) {
            if (!soundEnabled) return;
            
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            const sounds = {
                toggle: { freq: 800, duration: 0.1 },
                submit: { freq: 600, duration: 0.15 },
                error: { freq: 200, duration: 0.2 },
                apocalypse: { freq: 100, duration: 0.5 }
            };
            
            const sound = sounds[type] || sounds.toggle;
            oscillator.frequency.value = sound.freq;
            gainNode.gain.value = 0.1;
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + sound.duration);
        }

        // Particle system
        function createParticles() {
            const container = document.getElementById('particles');
            const particleCount = 30;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDuration = (Math.random() * 3 + 2) + 's';
                particle.style.animationDelay = Math.random() * 2 + 's';
                particle.style.opacity = Math.random() * 0.5 + 0.3;
                container.appendChild(particle);
            }
        }

        // Konami code easter egg
        function konami() {
            showError('💀 TRY: ↑↑↓↓←→←→BA');
        }

        function activateKonami() {
            document.body.style.animation = 'apocalypseGradient 1s ease infinite';
            showError('🎮 KONAMI CODE ACTIVATED! CHAOS MODE!');
            playSound('apocalypse');
            
            // Extra chaotic effects
            let chaosInterval = setInterval(() => {
                if (Math.random() > 0.7) {
                    document.body.style.filter = `hue-rotate(${Math.random() * 360}deg)`;
                    setTimeout(() => {
                        document.body.style.filter = 'none';
                    }, 100);
                }
            }, 500);
            
            setTimeout(() => {
                clearInterval(chaosInterval);
                document.body.style.filter = 'none';
                showError('🎮 CHAOS MODE DEACTIVATED');
            }, 10000);
        }

        // Enhanced save message with sound
        const originalSaveMessage = saveMessage;
        saveMessage = function() {
            originalSaveMessage();
            if (soundEnabled) playSound('submit');
        };

        // Initialize effects
        createParticles();

        // Search messages
        function searchMessages() {
            searchQuery = document.getElementById('searchBox').value;
            displayMessages();
        }

        // Sort messages
        function sortMessages(type) {
            currentSort = type;
            
            document.querySelectorAll('.sort-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            displayMessages();
        }

        function sortMessagesList(msgs) {
            const sorted = [...msgs];
            
            switch(currentSort) {
                case 'newest':
                    return sorted.sort((a, b) => b.timestamp - a.timestamp);
                case 'oldest':
                    return sorted.sort((a, b) => a.timestamp - b.timestamp);
                case 'author':
                    return sorted.sort((a, b) => a.author.localeCompare(b.author));
                case 'popular':
                    return sorted.sort((a, b) => {
                        const aTotal = (a.reactions?.fire || 0) + (a.reactions?.skull || 0) + (a.reactions?.heart || 0);
                        const bTotal = (b.reactions?.fire || 0) + (b.reactions?.skull || 0) + (b.reactions?.heart || 0);
                        return bTotal - aTotal;
                    });
                default:
                    return sorted;
            }
        }

        // Switch view
        function switchView(view) {
            currentView = view;
            
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            const grid = document.getElementById('messagesGrid');
            const list = document.getElementById('messagesList');
            
            if (view === 'grid') {
                grid.classList.add('active');
                list.classList.remove('active');
            } else {
                grid.classList.remove('active');
                list.classList.add('active');
            }
        }

        // Add reaction
        function addReaction(msgId, type) {
            const message = messages.find(m => m.id == msgId);
            if (message) {
                // Initialize reactions if not present
                if (!message.reactions) {
                    message.reactions = { fire: 0, skull: 0, heart: 0 };
                }
                
                // Increment reaction count
                message.reactions[type] = (message.reactions[type] || 0) + 1;
                
                // Save to localStorage
                localStorage.setItem('apocalypseMessages', JSON.stringify(messages));
                
                // Update display
                displayMessages();
                updateStats();
                
                // Sound feedback
                if (soundEnabled) playSound('toggle');
                
                // Visual feedback
                showError(`${type === 'fire' ? '🔥' : type === 'skull' ? '💀' : '❤️'} REACTION ADDED!`);
            }
        }

        // Delete message
        function deleteMessage(msgId) {
            const message = messages.find(m => m.id == msgId);
            
            // Security check: only allow user to delete their own messages
            if (!message) {
                showError('❌ MESSAGE NOT FOUND');
                return;
            }
            
            if (message.userId !== currentUser) {
                showError('🚫 YOU CAN ONLY DELETE YOUR OWN MESSAGES!');
                return;
            }
            
            if (confirm('Delete this message? This cannot be undone!')) {
                messages = messages.filter(m => m.id != msgId);
                localStorage.setItem('apocalypseMessages', JSON.stringify(messages));
                displayMessages();
                updateStats();
                showError('🗑️ MESSAGE DELETED');
                if (soundEnabled) playSound('error');
            }
        }

        // Copy message
        function copyMessage(msgId) {
            const message = messages.find(m => m.id == msgId);
            if (message) {
                const text = `"${message.content}" - ${message.author}`;
                navigator.clipboard.writeText(text).then(() => {
                    showError('📋 MESSAGE COPIED!');
                }).catch(() => {
                    showError('❌ COPY FAILED');
                });
            }
        }



        // Check countdown and trigger apocalypse
        function checkApocalypse() {
            const endDate = new Date();
            endDate.setHours(23, 59, 59, 999);
            const now = new Date();
            const diff = endDate - now;
            
            if (diff <= 60000 && diff > 0) { // Last minute
                triggerApocalypse();
            }
        }

        function triggerApocalypse() {
            const modal = document.getElementById('apocalypseMode');
            const message = document.getElementById('apocalypseMessage');
            
            modal.classList.add('active');
            
            const messages = [
                'SYSTEMS FAILING...',
                'FINAL MESSAGES BEING SAVED...',
                'GOODBYE, INTERNET...',
                'THIS IS THE END...',
                'OR IS IT A NEW BEGINNING?'
            ];
            
            let i = 0;
            const interval = setInterval(() => {
                message.textContent = messages[i];
                i++;
                if (i >= messages.length) {
                    clearInterval(interval);
                    setTimeout(() => {
                        modal.classList.remove('active');
                    }, 3000);
                }
            }, 2000);
        }

        // Check every minute
        setInterval(checkApocalypse, 60000);
    </script>
</body>
</html>
